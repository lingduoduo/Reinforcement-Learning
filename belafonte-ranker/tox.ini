[tox]
minversion = 2.3.1
skipsdist = true
skip_missing_interpreters = true
envlist = flake8, py37
indexserver =
    default = https://artifactory.spotify.net/artifactory/api/pypi/pypi/simple/

[pytest]
python_classes =
    *Test
    Test*

[testenv]
basepython = python3.7
setenv =
    SOURCE = {toxinidir}/belafonte-ranker/src/main/python
    TEST_SOURCE = {toxinidir}/belafonte-ranker/src/test/python
    PYTHONPATH = {env:SOURCE}

passenv =
    GOOGLE_APPLICATION_CREDENTIALS
deps =
    -rrequirements.txt
    -rtest-requirements.txt

commands =
    coverage erase
    coverage run --source {env:SOURCE} -m pytest --junit-xml=junit.xml {env:TEST_SOURCE}
    coverage report -m --rcfile=coverage.ini --fail-under 60
    coverage xml -o cobertura.xml

[flake8]
ignore = E402,E501,W503

[testenv:flake8]
commands =
    flake8 {env:SOURCE} {env:TEST_SOURCE}
